"use strict";
// Copyright (c) 2020,2021,2022, StepZen, Inc.
Object.defineProperty(exports, "__esModule", { value: true });
const debug = require("debug");
const node_fetch_1 = require("node-fetch");
const constants_1 = require("../shared/constants");
const request_1 = require("../shared/request");
exports.default = async (account, sdkConfig) => {
    const headers = (0, request_1.getRequestHeaders)(account, sdkConfig);
    const url = `${account.server}${constants_1.ADMIN_ACCOUNT_URL}`;
    debug('stepzen:headers')(headers);
    const response = await (0, node_fetch_1.default)(url, {
        headers: headers,
        method: 'POST',
    });
    debug('stepzen:response')(response);
    if (response.status === 401 || response.status === 403) {
        throw new Error('Could not complete the request. Please check your authentication details are correct.');
    }
    if (response.status >= 400) {
        return {
            errors: [response.statusText],
            success: false,
        };
    }
    const text = await response.text();
    let json;
    try {
        json = JSON.parse(text);
    }
    catch (_a) {
        return {
            errors: [`An unexpected error occurred.\n\n${text}`],
            success: false,
        };
    }
    return json;
};
//# sourceMappingURL=account.js.map